<template>
  <v-container
    align-baseline="true"
    class="container">
    <v-row class="mx-2">
      <h2>리뷰 작성</h2>
    </v-row>
    <v-row class="mx-2">
      <v-col cols="8">
        <v-text-field
          label="제목"
          v-model="title"
          :color="this.$store.state.color"
        />
      </v-col>
    </v-row>
    <v-row class="mx-2" align="center">
      <v-col cols="3">
        <v-text-field
          label="모델명"
          v-model="model"
          :color="this.$store.state.color"
        />
      </v-col>
      <v-col cols="3">
        <v-layout row wrap>
        <v-menu
          lazy
          :close-on-content-click="false"
          v-model="menu"
          transition="scale-transition"
          offset-y
          full-width
          :nudge-right="40"
          max-width="290px"
          min-width="290px"
        >
          <template v-slot:activator="{ on }">
            <v-text-field
              label="사용 날짜"
              prepend-icon="event"
              readonly
              :value="useDate"
              v-on="on"
              color="rgb(203, 203, 77)"
            ></v-text-field>
          </template>
          <v-date-picker
            v-model="useDate"
            no-title
            color="rgb(203, 203, 77)"
            @input="menu = false"
            scrollable></v-date-picker>
        </v-menu>
        </v-layout>
      </v-col>
      <v-col cols="3">
        <v-rating
          v-model="rating"
          :background-color="this.$store.state.color"
          size="40"
          :color="this.$store.state.color"
        ></v-rating>
      </v-col>
    </v-row>
    <v-row class="mx-2" align="center">
      <v-col cols="8">
        <v-textarea
          label="리뷰 내용"
          :color="this.$store.state.color"
          outlined
          v-model="context"
        />
      </v-col>
    </v-row>
    <v-row class="mx-2" align="center">
      <v-col cols="8">
        <v-file-input
          multiple
          :color="this.$store.state.color"
          v-model="files"
          label="사진 업로드"
        >
        </v-file-input>
      </v-col>
    </v-row>
    <v-row>
      <v-spacer/>
      <v-col cols="5">
        <v-btn
          :color="this.$store.state.color"
          @click="writeReview">
          submit</v-btn>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import axios from 'axios'
export default {
  name: 'WriteReview',
  data () {
    return {
      title: '',
      model: '',
      rating: 0,
      menu: false,
      useDate: new Date().toISOString().substr(0, 10),
      context: '',
      files: []
    }
  },
  mounted () {
    // 로그인 하지 않았으면 이용 불가
    if (this.$session.get('id') == null) {
      alert('로그인이 필요한 서비스입니다.')
      this.$router.push('/user/login')
    }
  },
  methods: {
    writeReview () {
      var reviewData = {
        'title': this.title,
        'writer': this.$session.get('id'),
        'model': this.model,
        'regDate': new Date(),
        'useDate': this.useDate,
        'rating': this.rating,
        'context': this.context,
        'files': this.files
      }

      axios
        .post('http://localhost:8080/review/save', reviewData)
        .then(response => {
          if (response.data.data === 'success') {
            alert('리뷰가 등록되었습니다.')
            this.$router.push('/')
          } else {
            alert('리뷰 등록에 실패했습니다.')
          }
        })
    }
  }
}
</script>

<style>
  .container {
    margin-top: 20px;
  }
</style>
